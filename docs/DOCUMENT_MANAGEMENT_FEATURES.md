# 📁 文件管理功能完整指南

## ✨ 新增功能概覽

### 1. 增強型文件卡片

每個文件卡片現在顯示：

#### 📊 基本資訊
- **文件圖示**：根據文件類型顯示（PDF/Word 圖示）
- **文件名稱**：可點擊編輯的文件名稱
- **文件格式**：PDF、DOCX、DOC
- **上傳時間**：智能相對時間顯示
  - 剛才
  - X 分鐘前
  - X 小時前
  - 今天/昨天
  - X 天前
  - 具體日期（超過一週）

#### 🎯 解析狀態
- **成功**：綠色徽章 + ✓ 圖示
- **處理中**：黃色徽章 + 旋轉載入圖示
- **失敗**：紅色徽章 + ✗ 圖示

#### 📈 統計資訊
- **截止日期數量**：顯示 AI 解析出的截止日期總數
  - 例如：「5 個截止日期」

### 2. 文件操作功能

#### ✏️ 重新命名
1. 點擊文件卡片右側的「⋮」選單
2. 選擇「重新命名」
3. 直接在卡片上編輯文件名
4. 按 Enter 確認，Esc 取消

#### 🗑️ 刪除文件
1. 點擊文件卡片右側的「⋮」選單
2. 選擇「刪除」
3. 確認對話框會顯示：
   - 文件名稱
   - 警告：將永久刪除文件及所有截止日期
   - 此操作無法復原
4. 點擊「刪除」確認，或「取消」放棄

**刪除範圍：**
- ✅ 從資料庫刪除文件記錄
- ✅ 刪除所有相關的截止日期
- ✅ 從 Supabase Storage 刪除實際文件

### 3. UI/UX 改進

#### 🎨 視覺設計
- **卡片式設計**：圓角、陰影、清晰層次
- **懸浮效果**：滑鼠移過時顯示陰影和邊框
- **選中高亮**：當前選中的文件有藍色邊框和背景
- **狀態顏色**：
  - 成功：綠色 (#10B981)
  - 處理中：琥珀色 (#F59E0B)
  - 失敗：紅色 (#EF4444)

#### 🖱️ 互動體驗
- **漸進式操作**：懸浮時才顯示操作按鈕，減少視覺混亂
- **即時反饋**：所有操作都有 toast 提示
- **確認對話框**：危險操作（刪除）需要二次確認
- **inline 編輯**：重命名直接在卡片上完成，無需跳轉

#### 📱 響應式設計
- 自適應不同螢幕尺寸
- 觸控友好的按鈕大小
- 文字截斷處理（過長文件名）

### 4. 多文件上傳

#### 上傳方式
- **拖曳上傳**：拖曳多個文件到上傳區域
- **點擊選擇**：點擊上傳區域，選擇多個文件
- **最大數量**：一次最多 10 個文件
- **文件大小**：每個最大 10MB

#### 上傳進度
- 每個文件顯示單獨的進度條
- 即時狀態更新：
  - 上傳中：旋轉圖示
  - 成功：綠色勾號
  - 失敗：紅色叉號
- 3 秒後自動清除進度列表

## 🔧 技術實作

### 前端組件

#### DocumentCard.tsx
```typescript
<DocumentCard
  document={doc}
  isActive={activeDoc?.id === doc.id}
  eventCount={eventCounts[doc.id] || 0}
  onClick={() => selectDocument(doc)}
  onDelete={handleDeleteDocument}
  onRename={handleRenameDocument}
/>
```

**特色：**
- 自包含的組件，包含所有 UI 和邏輯
- 使用 AlertDialog 進行刪除確認
- 使用 DropdownMenu 顯示操作選單
- Inline 編輯文件名

#### DocumentUploader.tsx
**升級點：**
- 支援多文件同時上傳
- 並行上傳（Promise.all）
- 即時進度追蹤
- 自動清除完成項目

### 後端 API

#### GET /api/v1/projects/{id}/documents
獲取專案的所有文件列表

**回應：**
```json
[
  {
    "id": "uuid",
    "original_filename": "合約書.docx",
    "file_type": "docx",
    "status": "completed",
    "created_at": "2026-02-11T06:00:00Z",
    ...
  }
]
```

#### DELETE /api/v1/documents/{id}
刪除文件及其所有相關資料

**操作：**
1. 驗證使用者權限
2. 刪除 Supabase Storage 中的文件
3. 刪除所有相關的 deadline_events
4. 刪除 documents 記錄

#### PATCH /api/v1/documents/{id}
更新文件元資料

**可更新欄位：**
- `original_filename`：文件名稱
- `status`：狀態

**請求範例：**
```json
{
  "original_filename": "新的文件名.docx"
}
```

## 📊 使用流程

### 上傳多個文件
1. 前往專案頁面
2. 拖曳或選擇多個文件
3. 等待上傳完成
4. 查看每個文件的上傳狀態
5. 文件列表自動更新

### 管理文件
1. 在文件列表中找到目標文件
2. 點擊文件卡片查看內容和解析結果
3. 點擊「⋮」按鈕顯示操作選單
4. 選擇操作：
   - 重新命名：inline 編輯
   - 刪除：確認後永久刪除

### 查看解析結果
1. 點擊文件卡片
2. 左側顯示文件內容預覽
3. 右側顯示 AI 解析的截止日期
4. 截止日期數量顯示在文件卡片上

## 🎯 使用者體驗亮點

### 1. 智能時間顯示
- 最近的時間使用相對格式（「5 分鐘前」）
- 較久的時間顯示具體日期
- 方便快速識別文件新舊

### 2. 視覺反饋
- 所有操作都有即時反饋
- 成功/失敗狀態清晰可見
- 處理中狀態有動畫提示

### 3. 防誤操作
- 刪除需要二次確認
- 確認對話框顯示詳細資訊
- 清楚說明操作後果

### 4. 效率優化
- 多文件並行上傳
- 懸浮顯示操作，減少視覺干擾
- Inline 編輯，無需頁面跳轉

## 🐛 錯誤處理

### 上傳失敗
- 顯示錯誤 toast
- 標記失敗的文件
- 不影響其他文件上傳

### 刪除失敗
- 顯示錯誤 toast
- 文件保持在列表中
- 可重試操作

### 重命名失敗
- 顯示錯誤 toast
- 恢復原文件名
- 可重新編輯

## 📝 未來增強

### 短期
- [ ] 批量刪除
- [ ] 文件排序（按日期、名稱、狀態）
- [ ] 文件搜尋/過濾
- [ ] 文件下載功能

### 長期
- [ ] 文件標籤系統
- [ ] 文件版本控制
- [ ] 文件分享功能
- [ ] 文件預覽優化（PDF 直接預覽）
